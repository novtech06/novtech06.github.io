<!-- boostrap cdn 4.5 -->
<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.css">
<!-- jquery -->
<script src="assets/jquery.min.js"></script>

<!-- instascan -->
<script src="assets/instascan.min.js"></script>

<body>

    <div class="container">
        <div class="row justify-content-center mt-5">
            <div class="col-md-5">
                <div class="card-header bg-transparent mb-0">
                    <h5 class="text-center">
                        <span class="font-weight-bold text-primary">
                            scan 1.8
                        </span>
                    </h5>
                </div>
                <div class="card-body">
                    <video id="scan-qrcode" class="mb-3" width="auto" height="auto" style="border: 1px solid black;"></video>
                    <div class="form-group">
                        <button type="button" onclick="addClassValue()" id="buttonValue" class="invalid">switch</button>
                        <input type="text" id="qrcode" class="form-control my-3" disabled>
                        <div id="munculTombol">

                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>

</body>

<script>
    let buttonValue = document.getElementById('buttonValue');
    let valid = document.getElementsByClassName('valid');
    let invalid = document.getElementsByClassName('invalid');

    // function addClassValue(){
    //     if(valid.length == 1){
    //         buttonValue.classList.add('invalid');
    //         buttonValue.classList.remove('valid');
    //         console.log('sukses invalid');
    //     }else if(invalid.length == 1){
    //         buttonValue.classList.add('valid');
    //         buttonValue.classList.remove('invalid');
    //         console.log('sukses valid');
    //     }
    // }

    let scanner = new Instascan.Scanner({
        video: document.getElementById('scan-qrcode')
    });
    scanner.addListener('scan', function(content) {
        let tombolNext = document.getElementById('tombolNext');
        // alert(content);
        $("#qrcode").val(content);
        if(!tombolNext){
            $('#munculTombol').append('<form action="#" method="post"><a href="#" class="btn btn-primary" id="tombolNext">Next</a></form>');
        }
    });
    
    function addClassValue(){
        Instascan.Camera.getCameras().then(function(cameras) {
            if (cameras.length > 1) {
                if(valid.length == 1){
                    scanner.start(cameras[0]);  
                    buttonValue.classList.add('invalid');
                    buttonValue.classList.remove('valid');
                    console.log('sukses invalid');
                }else if(invalid.length == 1){
                    scanner.start(cameras[1]);
                    buttonValue.classList.add('valid');
                    buttonValue.classList.remove('invalid');
                    console.log('sukses valid');
                }
            } else if(cameras.length == 1){
                console.log('kamera anda hanya 1');
                scanner.start(cameras[0]);    
            }else{
                console.error('No Cameras Found');
            }
        }).catch(function(e) {
            console.error(e.message);
            // console.error(e);
        });
    }


    // function addClassValue(){
    //     // jika kamera tidak ada atau lebih dari 1
    //     if(cameras.length > 1){
    //         // tambah tombol switch
    //         $('#munculTombol').append('<button type="button" onclick="addClassValue()" id="buttonValue" class="valid">switch</button>');
            
    //         if(valid.length == 1){
    //             Instascan.Camera.getCameras().then(function(cameras) {
    //                 console.log(cameras.length == undefined);
    //                 if (cameras.length > 0) {
    //                     scanner.start(cameras[0]);
    //                 } else {
    //                     console.error('No Cameras Found');
    //                 }
    //             }).catch(function(e) {
    //                 console.error(e);
    //             });
    //             buttonValue.classList.add('invalid');
    //             buttonValue.classList.remove('valid');
    //             console.log('sukses invalid');
    //         }else if(invalid.length == 1){
    //             Instascan.Camera.getCameras().then(function(cameras) {
    //                 if (cameras.length > 0) {
    //                     scanner.start(cameras[1]);
    //                 } else {
    //                     console.error('No Cameras Found');
    //                 }
    //             }).catch(function(e) {
    //                 console.error(e);
    //             });
    //             buttonValue.classList.add('valid');
    //             buttonValue.classList.remove('invalid');
    //             console.log('sukses valid');
    //         }
    //     }else{
    //         // hapus tombol switch
    //         $('#munculTombol').remove();

    //         Instascan.Camera.getCameras().then(function(cameras) {
    //             if (cameras.length > 0) {
    //                 scanner.start(cameras[0]);
    //             } else {
    //                 console.error('No Cameras Found');
    //             }
    //         }).catch(function(e) {
    //             console.error(e);
    //         });
    //     }
    // }

    addClassValue();
    
</script>